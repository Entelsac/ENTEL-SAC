<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{--neon:#00eaff;--card:rgba(10,18,30,.65);}
html,body{touch-action:manipulation;}
body{margin:0;min-height:100vh;color:#fff;font-family:'Orbitron',sans-serif;background:linear-gradient(rgba(0,0,0,.78),rgba(0,0,0,.88)),url("{{BG_URL}}") no-repeat center/cover fixed;}
.wrap{max-width:900px;margin:0 auto;padding:18px 10px 40px;}
.topbar{display:flex;justify-content:space-between;align-items:center;background:rgba(0,0,0,.72);border:1px solid rgba(0,234,255,.18);border-radius:16px;padding:12px 14px;backdrop-filter:blur(6px);box-shadow:0 0 18px rgba(0,234,255,.12);margin-bottom:16px;}
.btn{border:1px solid rgba(0,234,255,.35);background:rgba(0,20,35,.55);color:var(--neon);padding:10px 12px;border-radius:10px;letter-spacing:2px;font-size:11px;text-decoration:none;}
.card{max-width:560px;margin:0 auto;background:var(--card);border-radius:18px;padding:16px;border:1px solid rgba(0,234,255,.15);backdrop-filter:blur(8px);box-shadow:0 0 22px rgba(0,234,255,.08);}
.title{text-align:center;letter-spacing:4px;color:var(--neon);margin:8px 0 12px;}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
input, select{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(0,234,255,.25);background:rgba(0,0,0,.55);color:#fff;font-family:'Orbitron',sans-serif;}
.btnMain{width:100%;padding:12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--neon),#0088ff);color:#001018;font-weight:600;letter-spacing:2px;box-shadow:0 0 18px rgba(0,234,255,.35);cursor:pointer;margin-top:8px;}
.sub{opacity:.55;text-align:center;letter-spacing:3px;margin:18px 0 8px;font-size:12px;}
.row{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 6px;border-top:1px solid rgba(255,255,255,.06);}
.row:first-child{border-top:none;}
.u2{opacity:.6;font-size:11px;margin-top:4px;letter-spacing:2px;}
.cr{color:var(--neon);letter-spacing:2px;}
.btnAdd{border:1px solid rgba(0,234,255,.35);background:rgba(0,20,35,.55);color:var(--neon);padding:10px 12px;border-radius:10px;font-family:'Orbitron',sans-serif;letter-spacing:2px;font-size:11px;cursor:pointer;white-space:nowrap;}
.btnDel{border:1px solid rgba(255,80,120,.35);background:rgba(30,0,10,.55);color:#ff8ab0;padding:10px 12px;border-radius:10px;font-family:'Orbitron',sans-serif;letter-spacing:2px;font-size:11px;cursor:pointer;white-space:nowrap;}
.note{opacity:.6;font-size:11px;letter-spacing:2px;margin-top:10px;text-align:center;}

.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.62);z-index:9999;padding:14px;}
.modal.show{display:flex;}
.modal-card{width:min(560px,100%);background:rgba(8,14,24,.92);border:1px solid rgba(0,234,255,.20);border-radius:18px;padding:16px;box-shadow:0 18px 60px rgba(0,0,0,.55);}
.modal-title{text-align:center;color:#9d7bff;font-weight:900;letter-spacing:2px;margin:6px 0 12px;}
.modal-row{display:flex;justify-content:space-between;gap:12px;padding:12px 12px;border-radius:14px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.08);margin-bottom:10px;font-weight:800;}
.modal-row span{opacity:.65;}
.modal-actions{display:flex;gap:10px;}
.modal-actions button{flex:1;}
</style>
</head>
<body>

{% if SHOW_CREATED_MODAL %}
<div id="createdModal" class="modal show">
  <div class="modal-card">
    <div class="modal-title">‚ú® USUARIO CREADO ‚ú®</div>

    <div class="modal-row"><span>Usuario:</span> <b id="cu">{{CREATED_USER}}</b></div>
    <div class="modal-row"><span>Contrase√±a:</span> <b id="cp">{{CREATED_PASS}}</b></div>
    <div class="modal-row"><span>Rol:</span> <b id="cr">{{CREATED_ROLE|upper}}</b></div>
    <div class="modal-row"><span>URL:</span> <b id="cl">{{PUBLIC_LOGIN_URL}}</b></div>

    <div class="modal-actions">
      <button class="btnAdd" onclick="copyCreated()">COPIAR</button>
      <button class="btnDel" onclick="closeModal()">CERRAR</button>
    </div>
  </div>
</div>
{% endif %}

<div class="wrap">
  <div class="topbar">
    <a class="btn" href="/">INICIO</a>
    <a class="btn" href="/logout">SALIR</a>
  </div>

  <div class="card">
    <div class="title">PANEL (ADMIN)</div>

    <form method="post" action="/admin/create_user">
      <div class="grid">
        <input name="new_username" placeholder="NUEVO USUARIO" required>
        <input name="new_password" type="text" placeholder="CONTRASE√ëA" required>
      </div>

      <div style="margin-top:10px;">
        <select name="new_role" required>
          <option value="cliente">USUARIO (CLIENTE)</option>
          {% if me.role == "superadmin" %}
            <option value="operador">OPERADOR (TRABAJADOR)</option>
            <option value="admin">ADMINISTRADOR (REVENDEDOR)</option>
          {% endif %}
        </select>
      </div>

      <button class="btnMain">CREAR USUARIO</button>
    </form>

    <div class="note">
      {% if me.role != "superadmin" %}
        Solo el S√öPER ADMIN puede crear ADMIN/OPERADOR y dar cr√©ditos.
      {% else %}
        S√öPER ADMIN: puedes crear ADMIN/OPERADOR, dar cr√©ditos y borrar usuarios.
      {% endif %}
    </div>

    <div class="sub">USUARIOS REGISTRADOS</div>

    {% for u in users %}
      <div class="row">
        <div>
          <div>{{u.username}}</div>
          <div class="u2">{{u.role|upper}}</div>
        </div>

        <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end;">
          <div class="cr">{{u.credits}} cr</div>

          {% if me.role == "superadmin" %}
            <form method="post" action="/admin/add_credits" style="margin:0;display:flex;gap:8px;align-items:center;">
              <input type="hidden" name="user_id" value="{{u.id}}">
              <input name="amount" type="number" min="1" value="1" style="width:90px;">
              <button class="btnAdd" type="submit">+ ADD</button>
            </form>

            {% if u.username not in ["root","airbone"] %}
              <form method="post" action="/admin/delete_user" style="margin:0;">
                <input type="hidden" name="user_id" value="{{u.id}}">
                <button class="btnDel" type="submit">BORRAR</button>
              </form>
            {% endif %}
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<script>
function closeModal(){
  const m = document.getElementById("createdModal");
  if(m) m.classList.remove("show");
  // limpia query params (opcional)
  if(window.history && window.history.replaceState){
    window.history.replaceState({}, document.title, "/admin");
  }
}
function copyCreated(){
  const u = document.getElementById("cu")?.innerText || "";
  const p = document.getElementById("cp")?.innerText || "";
  const r = document.getElementById("cr")?.innerText || "";
  const l = document.getElementById("cl")?.innerText || "";
  const text = `‚ú® ENTEL SAC ‚ú®\nüë§ User: ${u}\nüîí Password: ${p}\nüßæ Rol: ${r}\nüåê URL: ${l}`;
  navigator.clipboard.writeText(text).then(()=>{});
}
</script>
</body>
</html>
